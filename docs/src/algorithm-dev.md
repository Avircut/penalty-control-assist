# Алгоритм работы

## Отслеживание результатов

1. С помощью библиотеки `mss` делаются скриншоты выбранного пользователем экрана с частотой, указанной в конфигурации (параметр `fps`).
2. Из скриншота вырезается область HUD, указанная в конфигурации (параметр `hudCoords`).
3. Область HUD делится на две части: для первого и второго игрока.
4. Каждая часть анализируется с помощью OpenCV:
   - Изображение преобразуется в черно-белое с помощью функции `thresholding`
   - Находятся контуры с помощью `cv2.findContours`
   - Контуры преобразуются в ограничивающие прямоугольники с помощью `convert_contours_to_bboxes`
   - Прямоугольники сортируются слева направо с помощью `sort_bboxes`
   - Для каждого прямоугольника проверяется цвет пикселя внутри с помощью `cell_check`
   - Если цвет близок к зеленому, результат считается успешным (SUCCESS)
   - Если цвет близок к красному, результат считается неудачным (FAIL)
5. Если обнаружены новые результаты, они записываются в состояние игры с помощью `game.commit_result`
6. После записи результата проверяется, закончился ли матч с помощью `game.check_game_end`
7. Если матч не закончился, через 2 секунды отправляется нажатие клавиши Q в окно vMix для запуска таймера

## Запись в таблицу

Запись результатов в Excel-таблицу осуществляется с помощью библиотеки `pywin32`:

1. Открывается Excel-файл, указанный в конфигурации
2. Для каждого игрока записываются результаты ударов в соответствующие ячейки
3. Файл сохраняется

## Управление состоянием игры

Управление состоянием игры осуществляется с помощью класса `GameController`:

1. При начале серии создается новый объект серии с указанными игроками
2. При начале матча создается новый объект матча с игроками, меняющимися местами в каждом матче
3. При каждом ударе результат записывается в состояние игрока и проверяется, закончился ли матч
4. Если матч закончился, обновляется счет серии и начинается новый матч
5. Если серия закончилась (достигнуто максимальное количество матчей), серия завершается
